<meta charset="utf-8">

<link rel="stylesheet" type="text/css" href="css/teclado.css">
<style type="text/css">
  .top{
    margin-top: 7px;
  }
#teclado{
  width: 100%;
}

 
</style>
<span id="number" style="color:#424242 ;margin-left:5px;display:none;margin-top: 10px;"></span> 
<div id="modal8" class="modal modal-fixed-footer" style="height: 200px;width: 70%;text-align: center;margin: auto;">
            <div class="modal-content" id="paises">
               
            </div>
            <div class="modal-footer">
              <a href="#!" class=" modal-action modal-close waves-green red btn">Cancelar</a>
            </div>
</div>
<div class="app" >
                 <div id="balance" style="display: none">
                    <meta charset="utf-8">
                   <div>
                  <br><br>
                  <div id="historial"  style="margin-top:10px;">
                  <div id="carga" style="text-align:center;margin-top:200px;">
                          <div class="preloader-wrapper small active">
                          <div class="spinner-layer spinner-green-only">
                            <div class="circle-clipper left">
                              <div class="circle"></div>
                            </div><div class="gap-patch">
                              <div class="circle"></div>
                            </div><div class="circle-clipper right">
                              <div class="circle"></div>
                            </div>
                          </div>
                        </div>
                         <br>
                         <p id="loadtext">Cargando Historial</p>
                      </div></div>
                  </div>
                  <div class="fixed-action-btn vertical left click-to-toggle" style="bottom: 45px; left: 24px;position:fixed;z-index:1002;">
                      <a class="btn-floating btn-large btn-iosD" style="background:#4470B4;" onclick="Desvanceido()">
                        <i class="large material-icons" >&#xE896;</i>
                      </a>
                      <ul  > 
                        <li ><a class="btn-floating btn-ios" style="background:#4470B4;" onclick="Desvanceido();ContenidoPrincipal('puntos')"><i class="material-icons">&#xE56A;</i></a></li>
                        <li ><a class="btn-floating btn-ios" style="background:#4470B4;" onclick="Desvanceido();ContenidoPrincipal('recarga')"><i class="material-icons">&#xE870;</i></a></li>
                        <li ><a class="btn-floating btn-ios" style="background:#4470B4;" onclick="Desvanceido();ContenidoPrincipal('indicativos')"><i class="material-icons">&#xE80B;</i></a></li>
                        <li ><a class="btn-floating btn-ios" style="background:#4470B4;" onclick="Desvanceido();ContenidoPrincipal('llamar')"><i class="material-icons">&#xE0BB;</i></a></li>
                        <li ><a class="btn-floating btn-ios" style="background:#D0E86F;" onclick="Desvanceido();ContenidoPrincipal('balance')" ><i class="material-icons" style="color:#4470B4">&#xE873;</i></a></li>
                        <li ><a class="btn-floating btn-ios" style="background:#4470B4;" onclick="Desvanceido();ContenidoPrincipal('promocioneshoy')"><i class="material-icons">&#xE8B1;</i></a></li>
                      </ul>
                    </div>
                </div>
                <div class="row" id="telefono-contestado" style="position:fixed;width:100%;height:100%;top:0;left:0;z-index:100000;background:white;display: none">
                              <center>
                              <img src="img/logo.png" id="img-llam"><p style="color:#000" id="dtmf"></p>
                                  
                              </center>
                            <div class="col s12 row" >
                                <center>
                                    <div  id="opciones">
                                      <h5 style="font-style:italic ;font-family: GillSans, Calibri, Trebuchet, sans-serif;color:#4470B4;" id="num-llama"></h5>
                                    <div class="col s12 img-back">
                                        <center>  
                                            <div id="time-llama" style="color:#000;">
                                              <div class="progress" style="color:#000;background:#D0E86F;">
                                                <div class="indeterminate" style="color:#000;background:#4470B4;"></div>
                                              </div>
                                              <p style="color:#000" id="llamando">Llamando..</p>
                                            </div> 
                                        </center>
                                    </div>
                                      <div class="col s4">
                                           <button class="bg btn-floating btn waves-effect waves-light ds" style="background:#fff;border:1px solid #9e9e9e" >  <i class="material-icons" style="color:#333;font-size:30px;">&#xE02B;</i></button>
                                        </div>
                                        <div class="col s4" >
                                           <button class="btn-floating  waves-effect waves-light  ds bg" style="background:#fff;border:1px solid #9e9e9e" >  <i class="material-icons" style="color:#333;font-size:30px;" onclick="TecladoPequeno()" >&#xE0BC;</i></button>
                                        </div>
                                        <div class="col s4" id="speaker">    
                                           <a class="btn-floating  waves-effect bg " style="background:#fff;border:1px solid #9e9e9e" onclick="ActivarParlante()">   <i class="material-icons" style="color:#333;font-size:30px;" >&#xE04D;</i> </a>
                                        </div>
                                        <div class="col s12"><span></span></div>
                                       <!-- <div class="col s4">
                                           <button class="a btn-floating  waves-effect waves-light ds bg" style="background:#fff;border:1px solid #9e9e9e" >  <i class="material-icons" style="color:#333;font-size:30px;">&#xE145;</i></button>
                                        </div>
                                        <div class="col s4" id="estados-llama">
                                           <button class="a btn-floating btn waves-effect waves-light  ds bg" style="background:#fff;border:1px solid #9e9e9e" >  <i class="material-icons" style="color:#333;font-size:30px;" >&#xE034;</i></button>
                                        </div>
                                         <div class="col s4" >    
                                            <a class="a btn-floating waves-effect waves-light bg"  onclick="ConctsHtml()" style="background:#fff;border:1px solid #9e9e9e" >  <i class="material-icons" style="color:#333;font-size:30px;">&#xE853;</i>   </a>
                                        </div>-->
                                    </div>
                                    <div class="col s12" id="tecladopequeno" style="display:none">

                                           <center>
                                                 <div class="col s12">
                                                    <a class="btn-floating btn waves-effect waves-light sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="OcultarTeclado()"><i class="material-icons" style="color: #333">&#xE318;</i></a>
                                                    <br><br>
                                                 </div>
                                                <div class="col s4">
                                                    <a class="btn-floating btn waves-effect waves-light sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf(1)">1</a>
                                                     
                                                </div>
                                                <div class="col s4">
                                                    <a class="btn-floating btn waves-effect waves-light sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf(2)">2 </a>
                                                        
                                                </div>
                                                <div class="col s4">
                                                    <a class="btn-floating btn waves-effect waves-light sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf(3)">3</a>
                                                           
                                                </div>
                                                <div class="col s4">
                                                    <a class="btn-floating btn waves-effect waves-light a sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf(4)">4</a>
                                                </div>
                                                <div class="col s4">
                                                    <a class="btn-floating btn waves-effect waves-light a sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf(5)">5</a>
                                                </div>
                                                <div class="col s4">
                                                    <a class="btn-floating btn waves-effect waves-light a sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf(6)">6</a>
                                                </div>
                                                <div class="col s4">

                                                      <a class="btn-floating btn waves-effect waves-light a sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf(7)">7</a>
                                                </div>
                                                <div class="col s4">
                                                      <a class="btn-floating btn waves-effect waves-light a sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf(8)">8</a>
                                                </div>
                                                <div class="col s4">
                                                      <a class="btn-floating btn waves-effect waves-light a sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf(9)">9</a>
                                                </div>
                                                 <div class="col s4">

                                                      <a class="btn-floating btn waves-effect waves-light a sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf('*')">*</a>
                                                </div>
                                                <div class="col s4">
                                                      <a class="btn-floating btn waves-effect waves-light a sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf(0)">0</a>
                                                </div>
                                                <div class="col s4">
                                                      <a class="btn-floating btn waves-effect waves-light a sm" style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="Dtmf('#')">#</a>
                                                </div>
                                            </center>
                                    </div>
                                    <div class="col s12" id="contacs" style="display: none">
                                        <center>
                                                <div class="col s12">
                                                    <a class="btn-floating btn waves-effect waves-light " style="background:#fff;color:#333 ;border:1px solid #9e9e9e" onclick="OcultarTeclado()"><i class="material-icons" style="color:#333">&#xE318;</i></a>
                                                    <br><br>
                                                     <div id="htCons" style="overflow-y: auto;min-height: 1000px"></div>
                                                 </div>
                                             
                                    </div>
                                        <div class="col s12 fixed-action-btn" style="bottom: 10px;" id="colgar-di">
                                       
                                             <button class="btn-floating  btn-large waves-effect waves-light red darken-4" style="color:#fff32;width:68px;height:68.5px;font-size:45px;display: block" onclick="Colgar()" id="btncolllam" ><i class="material-icons" style="color:#fff32;font-size:38px;"  >&#xE0D1;</i></button > 
                                             <img src="img/bol.jpg" style="width:164px;height:70px;">
                                        </div>
                                </center>
                            </div>
                </div>
            </div>

 
  
            <div id='lio'>
                   <input   type="hidden" id="minutos" value="00">
                   <input   type="hidden" id="segundos" value="00">
                   <input   type="hidden" id="horas" value="00">
                   <input   type="hidden" id="esta" value="balance">
                   <input   type="hidden" id="colgado" value="0">
                   <input   type="hidden" id="contas_load" value="1">
                   <input   type="hidden" id="numero-llam" value="">
                   <input   type="hidden" name="dtmf_key" id="dtmf_key" value="0">
            </div>
        

    

        <script src="js/init.js"></script>
        <script src="js/linphone.js"></script>
        <script type="text/javascript" >
              $(document).ready(function(){
                         loadIndiLlamar();
                         console.log('312 3'.length);

                }
              );
                 
               

              
               document.addEventListener("deviceready", onDeviceReadyXD, false);
                var mySip;
                var interval;
                var options;var rf= false;
                function onDeviceReadyXD(){
                    document.getElementById('barraD').innerHTML='<button type="button"  style="background:#fff;color:#4470B4;" class="btn barraT material-icons" onclick="ContenidoPrincipal(\'llamar\');">&#xE0CD;</button><button type="button"  style="background:#fff;color:#4470B4;" class="btn barraT material-icons" onclick="ContenidoPrincipal(\'contactos\');">&#xE853;</button><button type="button"  style="background:#fff;color:#4470B4;" class="btn barraT material-icons" onclick="ContenidoPrincipal(\'balance\');">&#xE8B0;</button>';
                    document.getElementById('refresh').innerHTML='<i><span style="top:30px;font-size:35px;" class="material-icons"  onclick="Contenido(\'inicio.html\')">&#xE317;</span></i>';
                      if(localStorage.getItem('llamada') != null){
                           $('#telefono-contestado').css('display','block');
                           console.log(localStorage.getItem('llamada'));
                            $('#num-llama').html(localStorage.getItem('llamada'));
                           $('#number').html(localStorage.getItem('llamada'));
                           $('#horas').val(localStorage.getItem('hor'));
                           $('#minutos').val( localStorage.getItem('min'));
                           $('#segundos').val( localStorage.getItem('seg'));
                           $("#btncolllam").removeAttr("disabled");
                           $('#colgado').val("false");
                           $("#btncolllam").removeAttr("disabled");
                           if (localStorage.getItem('seg') != '00'){
                               callEstablished();
                           }
                      }else{
                        var numero = $('#llamar-contact').val();
                        if(numero != 0){
                            LlamarOtroMedio(numero);
                        }else{
                             localStorage.setItem('seg','00');
                          localStorage.setItem('min','00');
                          localStorage.setItem('hor','00');
                         // mySip = cordova.plugins.SIP;
                          $('#balance').css('display','block');
                          Colombia();
                        
                         var cel = localStorage.getItem('cel');
                         var pas = localStorage.getItem('uipass');
                          console.log(cel);
                          console.log(pas);

                          Historial();
                          onRegister(cel,pas);
                          navigator.proximity.disableSensor();
                         console.log("se cargaron los contactos");
                            //cargar todos los contaactos

                            setTimeout(function(){
                              input=localStorage.getItem('credit');
                              var num = input.replace(/\./g,'');
                                if(!isNaN(num)){
                                num = num.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                                num = num.split('').reverse().join('').replace(/^[\.]/,'');
                                
                              }
                             document.getElementById('goodD').innerHTML= "Bienvenido "+localStorage.getItem('name')+"! - Saldo: $<span id='saldo_good'>"+num+"</span>";
                            var miId=localStorage.getItem('session');
                            var micred=localStorage.getItem('credit');
                            var param={'credit':miId};
                            console.log(localStorage.getItem('name')+"! - Saldo: $"+localStorage.getItem('credit'));
                              $.ajax({
                                 data:param,
                                  type:'POST',
                                  url:"https://app.emsivoz.co/funciones/prod/usuario-app/getCredit.php",
                                   
                                  success:function(data){

                                          if(data == "En estos momentos estamos realizando cambios "){
                                              document.getElementById('goodD').innerHTML= "En estos momentos estamos realizando cambios";
                                               $('#palabraD').css('background','#F2A914');
                                          }else{
                                            console.log(data);
                                            if(data != micred){
                                               localStorage.setItem('credit',data);
                                                input=localStorage.getItem('credit');
                                            var num = input.replace(/\./g,'');
                                              if(!isNaN(num)){
                                              num = num.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                                              num = num.split('').reverse().join('').replace(/^[\.]/,'');
                                              
                                            }
                                            if(input <= 500 ){
                                              $('#palabraD').css('background','#ED565A');
                                              $('#goodD').css('color','#fff');
                                              $('#malD').html('Â¡No olvides Recargar!');
                                              $('#sdf').html('<br>');
                                           }else{
                                              $('#palabraD').css('background','#D0E86F');
                                              $('#goodD').css('color','#4470B4');
                                              $('#malD').html('');
                                           }
                                               document.getElementById('goodD').innerHTML= "Bienvenido "+localStorage.getItem('name')+"! - Saldo: $<span id='saldo_good'>"+num+"</span>" ;
                                            }
                                        }
                                    }
                                });
                            },3000);

                        
                         

                        }
                          //cargar paises
                          console.log("se cargo todo bie");

                      }

                    
                        onStartListenerClick();
                }
                
                
                
                function LlamarOtroMedio(numero){
                  var numeroenvi="";
                  for (var i = 0; i < numero.length; i++) {
                      for (var j = 0; j <= 9;j++) {
                          if(numero[i] != " "){
                              if(numero[i] == j){
                                  numeroenvi = numeroenvi + numero[i];
                              }
                          }
                      }
                     if(i == 2){
                        if(numeroenvi == '57' || numeroenvi == '037'){
                          numeroenvi="";
                          console.log('sew cambio el numero');
                        }
                      }
                     
                  }

                  $('#number').html(numero);
                  $('#numero-llam').val(numeroenvi)
                  Llamar();
                }

                
                function Llamar(){
                  if (localStorage.getItem('llamada') == null) {
                    navigator.proximity.enableSensor();

                    setInterval(function(){
                      navigator.proximity.getProximityState(onSuccessProx);
                    }, 1000);
                    var num= $('#numero-llam').val();
                    var numeroenvi="";
                    for (var i = 0; i < num.length; i++) {
                        for (var j = 0; j <= 9;j++) {
                            if(num[i] != " "){
                                if(num[i] == j){
                                    numeroenvi = numeroenvi + num[i];
                                }
                            }
                        }
                       if(i == 2){
                          if(numeroenvi == '57' || numeroenvi == '037'){
                            numeroenvi="";
                            console.log('sew cambio el numero');
                          }
                        }
                       
                    }
                    if(numeroenvi.length >= 3){
                      console.log(numeroenvi);
                     onCall(numeroenvi);
                     localStorage.setItem('llamada',numeroenvi);
                    }
                  }else{
                    
                  }
                }

                function Colgar(){

                    //var $toastContent = $('<span>Llamada Finalizada</span>');
                   // Materialize.toast($toastContent, 3000);
                    clearInterval(interval);
                    localStorage.removeItem('llamada');
                    localStorage.removeItem('seg');
                    localStorage.removeItem('min');
                    localStorage.removeItem('hor');
                    $('#colgado').val('true');
                    onTerminateCall();
                    onDeregister();
                    ContenidoPrincipal('balance');
                }
                function ActivarParlante(){
                    $('#speaker').html('<a class="btn-floating btn-large waves-effect waves-light " style="background:#D0E86F;border:1px solid #D0E86F">  <i class="material-icons" style="color:#fff;font-size:30px;" onclick="DescativarParlante()">&#xE050;</i> </a>');
                      onEnableSpeakerClick();
                }
                function DescativarParlante(){
                    $('#speaker').html('<a class="btn-floating btn-large waves-effect waves-light" style="background:#D0E86F;border:1px solid #D0E86F">  <i class="material-icons" style="color:#fff;font-size:30px;" onclick="ActivarParlante()">&#xE04D;</i> </a>');
                      onDisableSpeakerClick();

                }
                function TecladoPequeno(){
                    $('#opciones').css('display','none');
                    $('#contacs').css('display','none');
                    $('#tecladopequeno').css('display','block');
                }
                function OcultarTeclado(){
                    $('#opciones').css('display','block');
                    $('#tecladopequeno').css('display','none');
                    $('#contacs').css('display','none');
                    $('#colgar-di').css('display','block');
                }
                function Dtmf(num){
                    console.log(num);
                  $('#dtmf_key').val(num);
                   onSendDtmfClick();
                   $('#dtmf').html($('#dtmf').html() + num);
                }
                function callEstablished(){
                    $(".ds").removeAttr("disabled");
                    interval=  setInterval(tiempo,1000);
                }
                function tiempo(){
                      var colgado = $('#colgado').val();
                      if(colgado == "false"){
                        var min = $('#minutos').val();
                        var seg = $('#segundos').val();
                        var hor = $('#horas').val();
                        var dddd = hor +':'+ min + ':'+ seg;
                        console.log(dddd);
                            if(seg == 59){
                                seg=00;
                                min=01+parseInt(min);
                                if(min < 10){
                                    min='0'+min;
                                  }
                            }else{
                                seg=01+parseInt(seg);
                            }
                            if(min == 59){
                                min=00;
                                hor=01+parseInt(hor);
                            }
                            
                          var string = "";
                          if(seg < 10){
                            seg='0'+seg;
                          }
                          
                          string += hor +':'+ min + ':'+ seg;
                          console.log(string);
                          $('#horas').val(hor);
                          $('#minutos').val(min);
                          $('#segundos').val(seg);
                          document.getElementById("time-llama").innerHTML = string;
                          localStorage.setItem('seg',seg);
                          localStorage.setItem('min',min);
                          localStorage.setItem('hor',hor);
                      }else{
                          clearInterval(interval);
                      }
                }

                function callEnd(){
                   // var $toastContent = $('<span>Llamada Finalizada</span>');
                     //Materialize.toast($toastContent, 3000);
                    clearInterval(interval);
                    localStorage.removeItem('llamada');
                    $('#colgado').val("true");
                    localStorage.removeItem('seg');
                    localStorage.removeItem('min');
                    localStorage.removeItem('hor');
                    ContenidoPrincipal('balance');

                }
                function Mute(){
                   //mySip.muteCall('on');
                }
                function Stop(){
                    $('#estados-llama').html('<a class="btn-floating btn-large waves-effect waves-light transparent" style="border:1px solid #fff">  <i class="material-icons" style="color:#fff;font-size:30px;" onclick="Listen()">&#xE037;</i></a>');
                    //mySip.stopListenCall();
                }
                function Listen(){
                   $('#estados-llama').html('<a class="btn-floating btn-large waves-effect waves-light transparent" style="border:1px solid #fff">  <i class="material-icons" style="color:#fff;font-size:30px;" onclick="Stop()">&#xE034;</i></a>');
                  // mySip.listenCall();
                }

                /*
                function connectSuccess(){
                    //$('#connect').html('Estas Conectado');
                    $('#connect').css('color','green');
                    $("#btnllam").removeAttr("disabled");
                     var $toastContent = $('<span>Estas Conectado</span>');
                     Materialize.toast($toastContent, 3000,'rounded');
                }
                function connectError(){
                   // $('#connect').html('No Estas Conectado');
                    $('#connect').css('color','red');
                    var $toastContent = $('<span>No se puede Conectar</span>');
                     Materialize.toast($toastContent, 3000);
                }
                function callReady(){
                    var num= $('#number').html();
                    $('#num-llama').html(num);
                    $('#telefono-contestado').css('display','block');
                    console.log(num);
                }
                function callError(){
                     var $toastContent = $('<span>Problemas al realizar Llamada</span>');
                     Materialize.toast($toastContent, 3000);
                      localStorage.removeItem('llamada');
                      localStorage.removeItem('seg');
                      localStorage.removeItem('min');
                      localStorage.removeItem('hor');
                   
                     navigator.notification.alert(
                            'Error de Llamada',  // message
                            alertDismissed,         // callback
                            'ERROR',            // title
                            'Aceptar'                  // buttonName
                        );
                }
                 function callErrorES(){
                     var $toastContent = $('<span>Problemas al realizar Llamada</span>');
                     Materialize.toast($toastContent, 3000);
                    localStorage.removeItem('llamada');
                    localStorage.removeItem('seg');
                    localStorage.removeItem('min');
                    localStorage.removeItem('hor');
                    ContenidoPrincipal('llamar');
                   
                     navigator.notification.alert(
                            'Error de Llamada',  // message
                            alertDismissed,         // callback
                            'ERROR',            // title
                            'Aceptar'                  // buttonName
                        );
                }
                function callRingingBack(){
                    $("#btncolllam").removeAttr("disabled");
                    $("#btncolllam").removeAttr("disabled");
                }
                function alertDismissed(){

                }
                */


                function Destin(){
                  $('#modal5').openModal();
                  
                }
                 function callRingingBack(){
                    $("#btncolllam").removeAttr("disabled");
                    $("#btncolllam").removeAttr("disabled");
                }
                function onSuccessProx(state) {
                      console.log('Proximity state: ' + (state ? 'near' : 'far'));
                };
                function ConctsHtml(){
                    $('#opciones').css('display','none');
                    $('#tecladopequeno').css('display','none');
                    $('#contacs').css('display','block');
                    $('#colgar-di').css('display','none');
                    $('#htCons').html($('#result').html());
                }
        </script>

   

  